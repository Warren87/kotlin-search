package be.rlab.search.model

import be.rlab.nlp.model.Language
import be.rlab.search.Hashes.generateId
import java.util.*

/** Represents a document in the Lucene index.
 */
data class Document(
    /** Document id generated by [generateId] */
    val id: String,
    /** Document namespace that represents this collection. */
    val namespace: String,
    /** List of fields */
    val fields: List<Field>,

    /** Document version, used to keep backward compatibility between releases. */
    val version: String
) {
    companion object {
        fun new(
            id: String,
            namespace: String,
            fields: List<Field>,
            version: String
        ): Document =
            Document(
                id = id,
                namespace = namespace,
                fields = fields,
                version = version
            )

        fun new(
            namespace: String,
            language: Language,
            fields: List<Field>,
            version: String
        ): Document =
            Document(
                id = generateId(UUID.randomUUID(), language),
                namespace = namespace,
                fields = fields,
                version = version
            )
    }

    inline operator fun<reified T> get(name: String): T? {
        return fields.find { field ->
            field.name == name
        }?.value as T
    }
}
